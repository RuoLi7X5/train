# 项目演进路线图 (Project Roadmap)

本文档旨在规划 "EverydayTongji" 项目的后续开发阶段。目标是将项目从单一的打卡工具演进为多租户、交互式、具备社区属性的围棋教育平台。

## 阶段一：架构重构与多租户体系 (Architecture & Multi-Tenancy) - [已完成]
**目标**：打好地基，支持多教练模式，优化基础用户体验。这是后续所有功能的基础。

### 1.1 多教练/多租户系统 (Feature 5) - [已完成]
- **需求**：
  - **超级管理员 (Super Admin)**：
    - 账号：`ruoli` (ID: `R000000`)。
    - 权限：
      - 创建/禁用教练账号。
      - **管理教练**：支持重置教练密码。
    - 个人教练账号需由 `ruoli` 另行创建。
  - **教练 (Coach)**：
    - 由超级管理员创建。
    - **管理学生**：
      - 管理名下的学生。
      - **重置密码**：可将学生密码重置为初始状态。
      - **移除绑定**：可将学生从班级/名下移除（**非删除账号**，账号保留在系统中但处于无教练状态），供其他教练重新绑定或回收。
  - **学生 (Student)**：
    - 与特定教练绑定。
    - 数据隔离：学生只能看到自己教练发布的题目。
  - **用户自服务**：
    - 所有用户（管理员、教练、学生）均可自行修改登录密码。
- **技术点**：
  - 数据库 Schema 变更：`User` 表增加 `role` (SUPER_ADMIN, COACH, STUDENT)。
  - 权限中间件逻辑更新。
  - 新增 API：`unbindStudent`, `resetPassword`, `changePassword`。

### 1.2 账号体系与自动生成池 (Account System) - [已完成]
- **需求**：
  - **ID 规范**：`R` + 6位数字 (如 `R000001`)，全局唯一。
  - **默认昵称**：`棋手` + ID后5位 (或随机字符)，允许修改。
  - **批量生成与“待定池”机制**：
    - 教练输入数量 (N)。
    - **密码设置**：**必需由教练在生成时手动输入统一的初始密码**（界面需有明确说明）。
    - 系统计算可用 ID，生成 N 个“待定”账号。
    - **确认机制**：教练点击确认 -> 账号正式激活 (Active)。
    - **回滚机制**：教练取消/未确认 -> 账号释放 (物理删除或标记无效)，ID 回收供下次使用。
- **技术点**：
  - **并发控制**：使用数据库事务或原子计数器，防止两个教练同时生成相同的 ID。
  - **状态机**：User 表增加 `status` (PENDING, ACTIVE, DISABLED)。
  - **ID 生成算法**：基于当前最大 ID 递增，支持回滚删除后的 ID 复用。

### 1.3 状态管理与体验优化 (Feature 2) - [已完成]
- **需求**：
  - 添加学生、创建班级后，页面列表自动刷新，无需手动 F5。
- **技术点**：
  - 引入 React 状态管理优化（如 `useContext` 或 `SWR`/`TanStack Query`）实现数据变动后的自动重新获取 (Revalidation)。
  - 优化 Loading 状态反馈。

### 1.4 个人中心与角色融合 (Personal Center & Role Fusion) - [已完成]
- **需求**：
  - **统一首页**：
    - 所有角色（包括教练）登录后，默认进入 **前台做题首页**。
    - 教练/管理员顶部导航栏显示醒目的 **“进入管理后台”** 按钮。
  - **个人中心**：
    - **入口**：学生端点击右上角头像；教练端侧边栏或前台头像。
    - **基本信息**：修改头像、修改昵称。
    - **数据展示**：积分、打卡次数、最高连胜、所属班级/教练信息。
    - **安全设置**：修改密码。
- **技术点**：
  - 修改 `login` 跳转逻辑。
  - 新增 `/profile` 页面。
  - `Navbar` 组件根据角色条件渲染“后台入口”。

---

## 阶段二：核心交互升级 - 盲棋训练系统 (Interactive Board)
**目标**：将“图片上传”升级为“交互式棋盘”，实现产品的核心教育价值（计算力训练）。

### 2.1 交互式围棋棋盘 (Feature 1 - Part A)
- **需求**：
  - 替换上传图片出题模式。教练在网页棋盘上摆题。
  - 数据库不再存图片 URL，改为存储棋谱数据 (SGF 格式或 JSON 坐标)。
- **技术点**：
  - 引入围棋前端库 (如 `WGo.js`, `Besogo`, 或 `Tenuki.js`)。
  - 实现 SGF 数据解析与存储。

### 2.2 智能棋盘展示 (Feature 1 - Part B)
- **需求**：
  - 根据题目棋子的坐标范围，自动判断展示规格：
    - 1/4 棋盘 (若棋子集中在某一角)。
    - 1/2 棋盘 (若棋子集中在半边)。
    - 全棋盘。
- **技术点**：
  - 编写坐标分析算法，计算棋子的 Bounding Box (边界框)。
  - 前端 CSS/Canvas 视口裁剪渲染。

### 2.3 “盲棋”做题模式 (Feature 1 - Part C)
- **需求**：
  - 学生点击棋盘落子。
  - **核心逻辑**：落子后，棋盘上**不显示**该棋子（视觉隐藏），但系统记录该步数。
  - 提交后与答案比对。
- **技术点**：
  - 前端状态管理：`moves` 数组存在，但渲染层过滤掉用户落子的渲染。

---

## 阶段三：教练品牌与内容展示 (Coach Profile & Content)
**目标**：增强教练的个人品牌展示，优化大量题目的浏览体验。

### 3.1 教练个人主页 (Feature 7)
- **需求**：
  - 展示教练名下不同班级的题目。
  - 分区展示：Class A (Row 1, Row 2), Class B...
  - 分页功能：每页 8 题。
- **技术点**：
  - 复杂查询：按 `coachId` + `classId` 分组查询。
  - 分页 API 实现 (`page`, `limit`)。

---

## 阶段四：增长与社交传播 (Growth & Sharing)
**目标**：利用社交分享带来裂变，增加用户粘性。

### 4.1 打卡海报生成 (Feature 3)
- **需求**：
  - 答题完成后，生成精美图片。
  - 内容：题目快照 + 鼓励语 + 打卡天数 + 个人信息。
- **技术点**：
  - 前端生成：使用 `html2canvas` 或 `satori` (Next.js OG Image generation)。
  - 动态合成图片。

---

## 阶段五：社区化 (Community)
**目标**：打造垂直交流圈，提升活跃度。

### 5.1 社区板块 (Feature 6)
- **需求**：
  - 顶部横幅与标语。
  - 发帖 (文字+图片)、评论、点赞。
  - 侧边栏：教练推荐卡片。
- **技术点**：
  - 新增大量数据表：`Post`, `Comment`, `Like`。
  - 图片上传 (R2) 在评论区的应用。
  - 复杂的时间流 (Timeline) 查询与无限滚动加载。

---

## 优先级总结 (Priority)

1.  **High (P0)**: 多租户架构 (1.1), 交互优化 (1.2). -> *系统能不能扩张的关键*
2.  **High (P1)**: 交互式盲棋 (2.1, 2.2, 2.3). -> *产品核心竞争力*
3.  **Medium (P2)**: 教练主页 (3.1), 学生信息 (1.3).
4.  **Low (P3)**: 打卡海报 (4.1).
5.  **Future (P4)**: 社区板块 (5.1).
