# 项目演进路线图 (Project Roadmap)

本文档旨在规划 "EverydayTongji" 项目的后续开发阶段。目标是将项目从单一的打卡工具演进为多租户、交互式、具备社区属性的围棋教育平台。

## 阶段一：架构重构与多租户体系 (Architecture & Multi-Tenancy) - [已完成]
**目标**：打好地基，支持多教练模式，优化基础用户体验。这是后续所有功能的基础。

### 1.1 多教练/多租户系统 (Feature 5) - [已完成]
- **需求**：
  - **超级管理员 (Super Admin)**：
    - 账号：`ruoli` (ID: `R000000`)。
    - 权限：
      - 创建/禁用教练账号。
      - **管理教练**：支持重置教练密码。
    - 个人教练账号需由 `ruoli` 另行创建。
  - **教练 (Coach)**：
    - 由超级管理员创建。
    - **管理学生**：
      - 管理名下的学生。
      - **重置密码**：可将学生密码重置为初始状态。
      - **移除绑定**：可将学生从班级/名下移除（**非删除账号**，账号保留在系统中但处于无教练状态），供其他教练重新绑定或回收。
  - **学生 (Student)**：
    - 与特定教练绑定。
    - 数据隔离：学生只能看到自己教练发布的题目。
  - **用户自服务**：
    - 所有用户（管理员、教练、学生）均可自行修改登录密码。
- **技术点**：
  - 数据库 Schema 变更：`User` 表增加 `role` (SUPER_ADMIN, COACH, STUDENT)。
  - 权限中间件逻辑更新。
  - 新增 API：`unbindStudent`, `resetPassword`, `changePassword`。

### 1.2 账号体系与自动生成池 (Account System) - [已完成]
- **需求**：
  - **ID 规范**：`R` + 6位数字 (如 `R000001`)，全局唯一。
  - **默认昵称**：`棋手` + ID后5位 (或随机字符)，允许修改。
  - **批量生成与“待定池”机制**：
    - 教练输入数量 (N)。
    - **密码设置**：**必需由教练在生成时手动输入统一的初始密码**（界面需有明确说明）。
    - 系统计算可用 ID，生成 N 个“待定”账号。
    - **确认机制**：教练点击确认 -> 账号正式激活 (Active)。
    - **回滚机制**：教练取消/未确认 -> 账号释放 (物理删除或标记无效)，ID 回收供下次使用。
- **技术点**：
  - **并发控制**：使用数据库事务或原子计数器，防止两个教练同时生成相同的 ID。
  - **状态机**：User 表增加 `status` (PENDING, ACTIVE, DISABLED)。
  - **ID 生成算法**：基于当前最大 ID 递增，支持回滚删除后的 ID 复用。

### 1.3 状态管理与体验优化 (Feature 2) - [已完成]
- **需求**：
  - 添加学生、创建班级后，页面列表自动刷新，无需手动 F5。
- **技术点**：
  - 引入 React 状态管理优化（如 `useContext` 或 `SWR`/`TanStack Query`）实现数据变动后的自动重新获取 (Revalidation)。
  - 优化 Loading 状态反馈。

### 1.4 个人中心与角色融合 (Personal Center & Role Fusion) - [已完成]
- **需求**：
  - **统一首页**：
    - 所有角色（包括教练）登录后，默认进入 **前台做题首页**。
    - 教练/管理员顶部导航栏显示醒目的 **“进入管理后台”** 按钮。
  - **个人中心**：
    - **入口**：学生端点击右上角头像；教练端侧边栏或前台头像。
    - **基本信息**：修改头像、修改昵称。
    - **数据展示**：积分、打卡次数、最高连胜、所属班级/教练信息。
    - **安全设置**：修改密码。
- **技术点**：
  - 修改 `login` 跳转逻辑。
  - 新增 `/profile` 页面。
  - `Navbar` 组件根据角色条件渲染“后台入口”。

---

## 阶段二：内容沉淀与个人展示 (Content & Identity)
**目标**：完善“人”和“题”的展示维度，增强超管的内容分发能力，从工具向平台过渡。

### 2.1 公共主页系统 (Public Profile System)
- **需求**：
  - **访问路径**：`/u/[id]` 或点击头像访问。
  - **公开性质**：默认全网公开，不设隐藏选项，展示真实数据。
  - **通用展示**：头像、昵称、身份标签、注册时间、公开统计（积分/做题数）。
  - **角色特有展示**：
    - **教练/超管**：显示 **出题历史 (Created Problems)** 列表。点击卡片可查看具体题目。
    - **学生**：显示成就墙、连续打卡记录等。
- **技术点**：
  - 新增 Public Profile 页面及数据 Fetch 接口。
  - 优化 `User` 表查询索引，支持高效读取公开信息。

### 2.2 增强发题与题库基础 (Advanced Publishing & Bank)
- **需求**：
  - **发题受众选择**：
    - `Private`：仅自己可见（草稿）。
    - `Students`：仅绑定学生可见（即目前的每日一题模式）。
    - **`Community` (新增)**：推送到公共社区/题库。
  - **推送控制**：
    - 可选是否推送到学生的“今日任务”首页（默认不推送超管题目，避免打扰）。
  - **公共题库 (Problem Bank V1)**：
    - **超管特权**：可直接发布题目到公共题库。
    - **普通用户**：后续可申请将题目上传至题库（需审核）。
    - **展示**：所有人可见的公共题库列表。
- **技术点**：
  - Schema 变更：`Problem` 表增加 `visibility` (PRIVATE, CLASS, PUBLIC) 和 `isPush` 字段。
  - 题库列表页开发。

### 2.3 首页专注模式 (Homepage Focus Mode)
- **需求**：
  - **设计原则 (方案A)**：极简主义，专注训练。
  - **核心内容**：仅展示 **今日一题** 的大卡片（含棋盘图片）。
  - **去干扰**：不展示复杂的推荐流或榜单，防止学生分心。
- **技术点**：
  - 首页 UI 重构，确保视觉重心在当前任务。

---

## 阶段三：社区化与资源共享 (Community & Resource Sharing)
**目标**：打破“一对一”强绑定，建立“多对多”的弱关注连接，实现资源流动。

### 3.1 题库进阶与审核体系 (Advanced Question Bank)
- **需求**：
  - **题库分级**：
    - **公开题库 (Public Bank)**：所有人可见。
    - **精选题库 (Curated/Premium Bank)**：需特定权限/付费/等级可见。
  - **投稿流程**：普通用户/教练提交题目 -> 进入审核队列 -> 超管审核 -> 归入题库。
- **技术点**：
  - 新增 `SubmissionQueue` 表或状态字段。
  - 后台新增“审核管理”界面。

### 3.2 关注与订阅系统 (Subscription System)
- **需求**：
  - **多维度连接**：学生除了绑定一个主教练（负责管理），还可以 **关注 (Follow)** 其他教练。
  - **资源获取**：
    - 关注后，可在“我的关注”板块查看该教练的历史题库。
    - 支持订阅特定教练的更新通知（非强制推送）。
- **技术点**：
  - 数据库：新增 `Follows` 表 (Many-to-Many: `followerId`, `followingId`)。
  - 前端：新增“关注列表”和“关注教练主页”视图。

---

## 阶段四：核心交互升级 - 盲棋训练系统 (Interactive Board)
**目标**：将“图片上传”升级为“交互式棋盘”，实现产品的核心教育价值（计算力训练）。

### 4.1 交互式围棋棋盘 (Feature 1 - Part A)
- **需求**：
  - 替换上传图片出题模式。教练在网页棋盘上摆题。
  - 教练与管理员出题界面默认展示全棋盘视图。
  - 摆题支持落子模式选择：连续黑、连续白、黑白交替。
  - 出题时选择黑先或白先，并填写文字描述。
  - 确认先手后进入“试下”状态，可自行落子验证思路。
  - 出题端“试下”落子同样遵循围棋规则。
  - 以上信息与棋谱数据一起作为题目数据推送。
  - 数据库不再存图片 URL，改为存储棋谱数据 (SGF 格式或 JSON 坐标)。
- **技术点**：
  - 引入围棋前端库 (如 `WGo.js`, `Besogo`, 或 `Tenuki.js`)。
  - 实现 SGF 数据解析与存储。
  - 题目数据结构扩展：落子模式、先手方、文字描述、摆题初始局面与答案手数。

### 4.2 智能棋盘展示 (Feature 1 - Part B)
- **需求**：
  - 根据题目棋子的坐标范围，自动判断展示规格（已完成）：
    - 1/4 棋盘 (若棋子集中在某一角)。
    - 1/2 棋盘 (若棋子集中在半边)。
    - 全棋盘（棋子分布不足以裁剪时兜底）。
  - 推送题目默认根据棋子分布自动裁剪视图（已完成）。
  - 学生端做题界面同样遵循裁剪规则展示棋盘（已完成）。
- **技术点**：
  - 编写坐标分析算法，计算棋子的 Bounding Box (边界框)（已完成）。
  - 前端 CSS/Canvas 视口裁剪渲染（已完成）。

### 4.3 “盲棋”做题模式 (Feature 1 - Part C)
- **需求**：
  - 学生点击棋盘落子。
  - **核心逻辑**：落子后，棋盘上**不显示**该棋子（视觉隐藏），但系统记录该步数。
  - 学生落子需符合围棋规则：气尽提子、打劫限制。
  - 提交后进入教练批改流程。
  - 落子时短暂显示带手数的棋子（约 0.5 秒）后消失（已完成）。
  - 提交记录可回放完整落子结果并显示手数（已完成）。
  - 提交记录中重复落点采用“1=3=7”格式，落到题目原始棋子用“R9=3”格式（已完成）。
  - 学生端试下按钮在收到老师反馈后显示，允许可见落子研究（已完成）。
  - 教练端批改详情支持落子过程回放，上一步/下一步（已完成）。
- **技术点**：
  - 前端状态管理：`moves` 数组存在，但渲染层过滤掉用户落子的渲染（已完成）。
  - 规则引擎：落子合法性校验、提子计算、劫争位置记录与禁入判断（已完成）。
  - 前端落子瞬显与手数渲染的计时控制（已完成）。
  - 提交记录的落子回放与格式化输出（已完成）。
  - 试下棋盘的可见落子与落子序号渲染（已完成）。
  - 教练端回放组件与步进控制（已完成）。

### 4.4 实施路径 (Phase 4 Delivery Plan)
- **落地步骤**：
  - 设计题目数据结构与数据库迁移（棋谱数据、先手方、落子模式、文字描述）（已完成）。
  - 开发出题棋盘编辑器（全棋盘视图、落子模式切换、先手与描述确认、试下模式入口）（已完成）。
  - 实现规则引擎与落子校验（气、提子、打劫），同时用于学生端与出题端试下（已完成）。
  - 完成智能裁剪渲染与推送展示（1/4、1/2、全棋盘兜底）（已完成）。
  - 对接学生端盲棋交互流程（已完成）。
  - 补齐学生端落子瞬显与提交记录回放展示（已完成）。
  - 增加学生端试下与教练端落子过程回放（已完成）。

---

## 阶段五：增长与社交传播 (Growth & Sharing)
**目标**：利用社交分享带来裂变，增加用户粘性。

### 5.1 打卡海报生成 (Feature 3)
- **需求**：
  - 答题完成后，生成精美图片。
  - 内容：题目快照 + 鼓励语 + 打卡天数 + 个人信息。
- **技术点**：
  - 前端生成：使用 `html2canvas` 或 `satori` (Next.js OG Image generation)。
  - 动态合成图片。

---

## 阶段六：社区板块 (Community Forum)
**目标**：打造垂直交流圈，提升活跃度。

### 6.1 社区讨论区 (Feature 6)
- **需求**：
  - 顶部横幅与标语。
  - 发帖 (文字+图片)、评论、点赞。
  - 侧边栏：教练推荐卡片。
- **技术点**：
  - 新增大量数据表：`Post`, `Comment`, `Like`。
  - 图片上传 (R2) 在评论区的应用。
  - 复杂的时间流 (Timeline) 查询与无限滚动加载。

---

## 优先级总结 (Priority)

1.  **High (P0)**: 内容沉淀与个人展示 (Phase 2). -> *建立平台内容深度*
2.  **High (P1)**: 交互式盲棋 (Phase 4). -> *产品核心竞争力*
3.  **Medium (P2)**: 社区化与资源共享 (Phase 3). -> *建立用户粘性*
4.  **Low (P3)**: 打卡海报 (Phase 5).
5.  **Future (P4)**: 社区讨论区 (Phase 6).
